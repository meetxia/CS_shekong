# æ¿€æ´»ç ç³»ç»Ÿç²¾ç®€é‡æ„æŒ‡å—

## ğŸ“‹ é‡æ„æ¦‚è¿°

æœ¬æ¬¡é‡æ„çš„ç›®æ ‡æ˜¯ç²¾ç®€æ¿€æ´»ç ç³»ç»Ÿçš„æ•°æ®åº“ç»“æ„,åˆ é™¤å†—ä½™å­—æ®µ,åªä¿ç•™æ ¸å¿ƒä¸šåŠ¡å¿…éœ€çš„å­—æ®µã€‚

### æ ¸å¿ƒéœ€æ±‚
- âœ… ä¸€ä¸ªæ¿€æ´»ç å¯ä»¥è¢«å¤šä¸ªè®¾å¤‡ä½¿ç”¨ (max_uses æ§åˆ¶)
- âœ… æ¯æ—¥æ¬¡æ•°é™åˆ¶æ˜¯æ‰€æœ‰è®¾å¤‡å…±äº« (daily_limit)
- âœ… åªå…³å¿ƒæ¯æ—¥å‰©ä½™æ¬¡æ•°,ä¸å…³å¿ƒæ€»ä½¿ç”¨æ¬¡æ•°
- âœ… å‰©ä½™æ—¶é—´ç²¾ç¡®åˆ°åˆ†é’Ÿ

---

## ğŸ—‚ï¸ æ•°æ®åº“ç»“æ„å˜æ›´

### activation_codes è¡¨ (æ¿€æ´»ç ä¸»è¡¨)

**åˆ é™¤çš„å­—æ®µ**:
- âŒ `expires_at` - æ¿€æ´»ç æœ¬èº«ä¸éœ€è¦è¿‡æœŸæ—¶é—´
- âŒ `updated_at` - å®é™…ç”¨å¤„ä¸å¤§
- âŒ `created_by` - å•ç®¡ç†å‘˜ç³»ç»Ÿä¸éœ€è¦

**ä¿ç•™çš„å­—æ®µ**:
- âœ… `id` - ä¸»é”®
- âœ… `code` - æ¿€æ´»ç 
- âœ… `status` - çŠ¶æ€
- âœ… `max_uses` - æœ€å¤§å¯æ¿€æ´»è®¾å¤‡æ•°
- âœ… `current_uses` - å½“å‰å·²æ¿€æ´»è®¾å¤‡æ•°
- âœ… `daily_limit` - æ¯æ—¥ä½¿ç”¨æ¬¡æ•°é™åˆ¶(æ‰€æœ‰è®¾å¤‡å…±äº«)
- âœ… `validity_days` - æ¿€æ´»åæœ‰æ•ˆå¤©æ•°
- âœ… `created_at` - åˆ›å»ºæ—¶é—´
- âœ… `notes` - å¤‡æ³¨

### activation_records è¡¨ (æ¿€æ´»è®°å½•è¡¨)

**åˆ é™¤çš„å­—æ®µ**:
- âŒ `ip_address` - å®é™…ç”¨å¤„ä¸å¤§
- âŒ `usage_count` - åªå…³å¿ƒæ¯æ—¥æ¬¡æ•°
- âŒ `last_used_at` - å®é™…ç”¨å¤„ä¸å¤§

**ä¿ç•™çš„å­—æ®µ**:
- âœ… `id` - ä¸»é”®
- âœ… `code_id` - æ¿€æ´»ç ID
- âœ… `activation_code` - æ¿€æ´»ç 
- âœ… `user_device_id` - è®¾å¤‡æ ‡è¯†
- âœ… `activated_at` - æ¿€æ´»æ—¶é—´(å€’è®¡æ—¶èµ·ç‚¹)
- âœ… `expires_at` - è¿‡æœŸæ—¶é—´(å€’è®¡æ—¶ç»ˆç‚¹)
- âœ… `usage_by_date` - æŒ‰æ—¥æœŸç»Ÿè®¡ä½¿ç”¨æ¬¡æ•°

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: å¤‡ä»½ç°æœ‰æ•°æ®åº“

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p shekong_ai > backup_$(date +%Y%m%d_%H%M%S).sql
```

### æ­¥éª¤2: æ‰§è¡Œæ•°æ®åº“è¿ç§»

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd h:\momo-ruanjiansheji\CS_shekong

# æ‰§è¡Œç²¾ç®€ç‰ˆæ•°æ®åº“è„šæœ¬
mysql -u root -p shekong_ai < backend/database_simplified.sql
```

âš ï¸ **æ³¨æ„**: `database_simplified.sql` ä¼šåˆ é™¤å¹¶é‡å»ºè¡¨,ç”Ÿäº§ç¯å¢ƒè¯·å…ˆå¤‡ä»½æ•°æ®!

### æ­¥éª¤3: é‡å¯åç«¯æœåŠ¡

```bash
# åœæ­¢ç°æœ‰åç«¯æœåŠ¡ (å¦‚æœæ­£åœ¨è¿è¡Œ)
# ç„¶åé‡æ–°å¯åŠ¨

cd backend
node server.js
```

### æ­¥éª¤4: é‡å¯å‰ç«¯æœåŠ¡

```bash
# åœæ­¢ç°æœ‰å‰ç«¯æœåŠ¡ (å¦‚æœæ­£åœ¨è¿è¡Œ)
# ç„¶åé‡æ–°å¯åŠ¨

npm run dev
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1: åˆ›å»ºæ¿€æ´»ç 

1. è®¿é—®ç®¡ç†åå°: `http://localhost:5173/admin`
2. ç™»å½•ç®¡ç†å‘˜è´¦å·
3. ç‚¹å‡»"æ–°å»ºæ¿€æ´»ç "
4. å¡«å†™ä¿¡æ¯:
   - æ¿€æ´»ç : è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥
   - æœ€å¤§ä½¿ç”¨æ¬¡æ•°: 21
   - æœ‰æ•ˆå¤©æ•°: 7
   - æ¯æ—¥ä¸Šé™: 3
   - å¤‡æ³¨: æµ‹è¯•æ¿€æ´»ç 
5. ç‚¹å‡»"ä¿å­˜"
6. âœ… éªŒè¯: æ¿€æ´»ç åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°åˆ›å»ºçš„æ¿€æ´»ç 

### æµ‹è¯•2: æ‰¹é‡åˆ›å»ºæ¿€æ´»ç 

1. ç‚¹å‡»"æ‰¹é‡æ–°å»º"
2. ç‚¹å‡»"ä¸€é”®ç”Ÿæˆ 10 ä¸ª"
3. è®¾ç½®é»˜è®¤å‚æ•°:
   - æœ€å¤§ä½¿ç”¨æ¬¡æ•°: 21
   - æœ‰æ•ˆå¤©æ•°: 7
   - æ¯æ—¥ä¸Šé™: 3
4. ç‚¹å‡»"æ‰¹é‡åˆ›å»º"
5. âœ… éªŒè¯: æ¿€æ´»ç åˆ—è¡¨ä¸­æ˜¾ç¤º10ä¸ªæ–°æ¿€æ´»ç 

### æµ‹è¯•3: ç¼–è¾‘æ¿€æ´»ç 

1. ç‚¹å‡»æŸä¸ªæ¿€æ´»ç çš„"ç¼–è¾‘"æŒ‰é’®
2. ä¿®æ”¹å¤‡æ³¨ä¿¡æ¯
3. ç‚¹å‡»"ä¿å­˜"
4. âœ… éªŒè¯: æ¿€æ´»ç åˆ—è¡¨ä¸­æ˜¾ç¤ºæ›´æ–°åçš„å¤‡æ³¨

### æµ‹è¯•4: æ’¤é”€æ¿€æ´»ç 

1. ç‚¹å‡»æŸä¸ªæ¿€æ´»ç çš„"æ’¤é”€"æŒ‰é’®
2. âœ… éªŒè¯: çŠ¶æ€å˜ä¸º"å·²æ’¤é”€"

### æµ‹è¯•5: åˆ é™¤æ¿€æ´»ç 

1. ç‚¹å‡»æŸä¸ªæ¿€æ´»ç çš„"åˆ é™¤"æŒ‰é’®
2. ç¡®è®¤åˆ é™¤
3. âœ… éªŒè¯: æ¿€æ´»ç ä»åˆ—è¡¨ä¸­æ¶ˆå¤±

### æµ‹è¯•6: éªŒè¯ä»Šæ—¥å·²ç”¨æ¬¡æ•°

1. å¤åˆ¶ä¸€ä¸ªæ¿€æ´»ç 
2. è®¿é—®æ¿€æ´»é¡µé¢: `http://localhost:5173/activation`
3. è¾“å…¥æ¿€æ´»ç å¹¶æ¿€æ´»
4. å®Œæˆä¸€æ¬¡æµ‹è¯„
5. è¿”å›ç®¡ç†åå°
6. âœ… éªŒè¯: "ä»Šæ—¥å·²ç”¨"åˆ—æ˜¾ç¤º `1 / 3`

### æµ‹è¯•7: éªŒè¯å‰©ä½™æ—¶é—´æ˜¾ç¤º

1. åœ¨ç®¡ç†åå°æŸ¥çœ‹å·²æ¿€æ´»çš„æ¿€æ´»ç 
2. âœ… éªŒè¯: "å‰©ä½™æ—¶é—´"åˆ—æ˜¾ç¤ºæ ¼å¼ä¸º `Xå¤©Xå°æ—¶Xåˆ†é’Ÿ`
3. âœ… éªŒè¯: æ—¶é—´ç²¾ç¡®åˆ°åˆ†é’Ÿ

### æµ‹è¯•8: éªŒè¯æ¯æ—¥æ¬¡æ•°é™åˆ¶

1. ä½¿ç”¨åŒä¸€ä¸ªæ¿€æ´»ç å®Œæˆ3æ¬¡æµ‹è¯„
2. å°è¯•ç¬¬4æ¬¡æµ‹è¯„
3. âœ… éªŒè¯: æç¤º"ä»Šæ—¥ä½¿ç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™"
4. è¿”å›ç®¡ç†åå°
5. âœ… éªŒè¯: "ä»Šæ—¥å·²ç”¨"åˆ—æ˜¾ç¤º `3 / 3` (çº¢è‰²èƒŒæ™¯)

### æµ‹è¯•9: éªŒè¯å¤šè®¾å¤‡å…±äº«æ¯æ—¥æ¬¡æ•°

1. è®¾å¤‡Aä½¿ç”¨æ¿€æ´»ç å®Œæˆ2æ¬¡æµ‹è¯„
2. è®¾å¤‡Bä½¿ç”¨åŒä¸€ä¸ªæ¿€æ´»ç å°è¯•æµ‹è¯„
3. âœ… éªŒè¯: è®¾å¤‡Båªèƒ½æµ‹è¯„1æ¬¡ (å› ä¸ºæ€»å…±åªèƒ½3æ¬¡)
4. è¿”å›ç®¡ç†åå°
5. âœ… éªŒè¯: "è®¾å¤‡ä½¿ç”¨æƒ…å†µ"æ˜¾ç¤º `2 / 21` (ä¸¤ä¸ªè®¾å¤‡)
6. âœ… éªŒè¯: "ä»Šæ—¥å·²ç”¨"æ˜¾ç¤º `3 / 3`

---

## ğŸ“Š ç®¡ç†åå°è¡¨æ ¼åˆ—è¯´æ˜

| åˆ—å | è¯´æ˜ | æ•°æ®æ¥æº |
|------|------|---------|
| æ¿€æ´»ç  | æ¿€æ´»ç å­—ç¬¦ä¸² | `activation_codes.code` |
| çŠ¶æ€ | å¯ç”¨/å·²è¿‡æœŸ/å·²æ’¤é”€ | `activation_codes.status` |
| è®¾å¤‡ä½¿ç”¨æƒ…å†µ | å·²æ¿€æ´»è®¾å¤‡æ•° / æœ€å¤§è®¾å¤‡æ•° | `activatedDevices / max_uses` |
| æœ‰æ•ˆå¤©æ•° | æ¿€æ´»åå¯ç”¨å¤©æ•° | `activation_codes.validity_days` |
| æ¯æ—¥ä¸Šé™ | æ‰€æœ‰è®¾å¤‡æ¯å¤©æ€»å…±å¯ç”¨æ¬¡æ•° | `activation_codes.daily_limit` |
| **ä»Šæ—¥å·²ç”¨** | ä»Šå¤©æ‰€æœ‰è®¾å¤‡æ€»å…±ç”¨äº†å‡ æ¬¡ | ä» `usage_by_date` ç»Ÿè®¡ |
| **å‰©ä½™æ—¶é—´** | æœ€æ—©æ¿€æ´»çš„è®¾å¤‡è¿˜å‰©å¤šå°‘æ—¶é—´ | è®¡ç®— `expires_at - now()` |
| å¤‡æ³¨ | ç®¡ç†å‘˜å¤‡æ³¨ | `activation_codes.notes` |
| æ“ä½œ | ç¼–è¾‘/æ’¤é”€/åˆ é™¤ | - |

---

## ğŸ¨ æ ·å¼è¯´æ˜

### ä»Šæ—¥å·²ç”¨æ¬¡æ•°é¢œè‰²

- ğŸŸ¢ **ç»¿è‰²**: ä½¿ç”¨æ¬¡æ•° < 80%
- ğŸŸ¡ **é»„è‰²**: ä½¿ç”¨æ¬¡æ•° >= 80%
- ğŸ”´ **çº¢è‰²**: ä½¿ç”¨æ¬¡æ•° = 100% (å·²ç”¨å®Œ)

### å‰©ä½™æ—¶é—´é¢œè‰²

- ğŸŸ¢ **ç»¿è‰²**: å‰©ä½™æ—¶é—´ > 1å¤©
- ğŸŸ¡ **é»„è‰²**: å‰©ä½™æ—¶é—´ <= 1å¤©
- ğŸŸ  **æ©™è‰²**: å‰©ä½™æ—¶é—´ < 1å¤©
- ğŸ”´ **çº¢è‰²**: å·²è¿‡æœŸ

---

## ğŸ”§ åç«¯APIå˜æ›´

### listActivationCodes è¿”å›æ•°æ®ç»“æ„

```javascript
{
  success: true,
  list: [
    {
      id: 1,
      code: 'TEST-2024-0001',
      status: 'active',
      max_uses: 21,
      current_uses: 2,
      daily_limit: 3,
      validity_days: 7,
      created_at: '2025-11-06 10:00:00',
      notes: 'æµ‹è¯•æ¿€æ´»ç ',
      
      // æ–°å¢å­—æ®µ
      todayUsed: 2,              // ä»Šæ—¥å·²ç”¨æ¬¡æ•°
      todayRemaining: 1,         // ä»Šæ—¥å‰©ä½™æ¬¡æ•°
      activatedDevices: 2,       // å·²æ¿€æ´»è®¾å¤‡æ•°
      timeRemaining: {           // å‰©ä½™æ—¶é—´å¯¹è±¡
        days: 6,
        hours: 14,
        minutes: 30,
        text: '6å¤©14å°æ—¶30åˆ†é’Ÿ'
      }
    }
  ],
  total: 10
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è¿ç§»**: `database_simplified.sql` ä¼šåˆ é™¤å¹¶é‡å»ºè¡¨,è¯·åŠ¡å¿…å…ˆå¤‡ä»½æ•°æ®
2. **ç”Ÿäº§ç¯å¢ƒ**: ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ `ALTER TABLE` è¿ç§»æ•°æ®,è€Œä¸æ˜¯åˆ é™¤é‡å»º
3. **æ—¶é—´ç²¾åº¦**: å‰©ä½™æ—¶é—´ç²¾ç¡®åˆ°åˆ†é’Ÿ,æ¯æ¬¡åˆ·æ–°é¡µé¢ä¼šé‡æ–°è®¡ç®—
4. **æ¯æ—¥æ¬¡æ•°**: æ¯æ—¥æ¬¡æ•°åœ¨ 00:00 è‡ªåŠ¨é‡ç½®
5. **å¤šè®¾å¤‡å…±äº«**: ä¸€ä¸ªæ¿€æ´»ç çš„æ‰€æœ‰è®¾å¤‡å…±äº«æ¯æ—¥æ¬¡æ•°é™åˆ¶

---

## ğŸ“ æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶
- âœ… `backend/database_simplified.sql` - ç²¾ç®€ç‰ˆæ•°æ®åº“è„šæœ¬
- âœ… `docs/æ¿€æ´»ç ç³»ç»Ÿç²¾ç®€é‡æ„æŒ‡å—.md` - æœ¬æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
- âœ… `backend/activationService.js` - åˆ é™¤å¯¹å†—ä½™å­—æ®µçš„å¼•ç”¨,æ·»åŠ ä»Šæ—¥å·²ç”¨æ¬¡æ•°å’Œå‰©ä½™æ—¶é—´è®¡ç®—
- âœ… `src/views/admin/AdminCodes.vue` - æ›´æ–°è¡¨æ ¼åˆ—,æ·»åŠ ä»Šæ—¥å·²ç”¨æ¬¡æ•°å’Œå‰©ä½™æ—¶é—´æ˜¾ç¤º

### æœªä¿®æ”¹æ–‡ä»¶
- âœ… `backend/routes/adminRoutes.js` - æ— éœ€ä¿®æ”¹
- âœ… `src/utils/backendActivation.js` - æ— éœ€ä¿®æ”¹

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®Œæˆæµ‹è¯•å,å»ºè®®:

1. âœ… éªŒè¯æ‰€æœ‰å¢åˆ æ”¹æŸ¥åŠŸèƒ½æ­£å¸¸
2. âœ… éªŒè¯å‰©ä½™æ—¶é—´æ˜¾ç¤ºç²¾ç¡®åˆ°åˆ†é’Ÿ
3. âœ… éªŒè¯ä»Šæ—¥å·²ç”¨æ¬¡æ•°æ­£ç¡®ç»Ÿè®¡
4. âœ… éªŒè¯å¤šè®¾å¤‡å…±äº«æ¯æ—¥æ¬¡æ•°é™åˆ¶
5. âœ… åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰,åŠ¡å¿…å¤‡ä»½æ•°æ®åº“

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æ£€æŸ¥:
- åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
- æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
- åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

