## 结果页算法优化说明（专业版）

本报告描述本次对结果页算法的系统性优化，目标是解决“结果千篇一律、建议复用严重”的问题，输出更专业、更个性化、更可执行的测评报告。

### 改动范围
- `src/utils/scoring.js`
  - 维持原有计分、等级与类型判定逻辑
  - 全面重写建议生成器：`getSuggestions`
  - 新增多项构建器与工具函数（稳定随机、暴露阶梯、每周计划、长期路径、指标追踪、优势与触发因素画像）

### 设计原则
- 个性化优先：结合基础信息（年龄/性别/职业/社交频率）与维度分布生成建议
- 多样但稳定：使用“稳定随机”策略（基于用户画像哈希），同一用户输出稳定，不同画像输出差异
- 临床可行性：借鉴CBT/暴露疗法/正念等循证路径，生成SMART目标与可量化指标
- 阶段化路径：认知→暴露→技能→关系→维护，给出时间窗与重点

### 新增产出结构
返回对象中的 `suggestions` 字段新增：
- `immediate`: 4-6条个性化“立即可做”的干预建议（含衡量指标）
- `weekly`: 4周渐进计划（随严重度调整剂量）
- `exposureLadder`: 6级暴露任务阶梯（按高维度自动生成）
- `longTermPath`: 长期改善路径（阶段化模块）
- `metrics`: 跟踪指标清单（SUDs、行动次数、反刍时长等）
- `strengths`: 优势清单（保护性因子）
- `triggers`: 触发因素画像（高风险维度映射）
- 保留原有 `longTerm` 与 `warning` 字段以向后兼容

### 核心算法要点
- 严重度带：将总分归一至100分后划分 normal/mild/moderate/severe/very_severe
- 高维度识别：取前三高分维度决定建议聚焦点
- 稳定随机：对 `age/gender/occupation/social_frequency/type` 进行哈希，驱动样本抽取
- 剂量调参：根据严重度调整每周最小任务数量与目标幅度

### 示例（字段示意）
```json
{
  "suggestions": {
    "immediate": [ { "title": "SMART目标：本周最小可行社交", "content": "...", "metric": "..." }, ... ],
    "weekly": { "week1": { "title": "...", "tasks": ["..."] }, ... , "principle": "..." },
    "exposureLadder": [ { "level": 1, "task": "..." }, ... ],
    "longTermPath": [ { "stage": "阶段1：认知重建", "duration": "1-2周", ... }, ... ],
    "metrics": [ { "name": "主观焦虑SUDs", "target": "..." }, ... ],
    "strengths": ["..."],
    "triggers": ["..."]
  }
}
```

### 兼容性
- 未改动 `generateReport` 的返回字段名与原有基础结构
- 新增字段为增量，不影响旧版渲染

### 后续建议
- 报告页可按需展示新字段：暴露阶梯、长期路径、指标追踪与优势/触发因素
- 允许用户勾选完成任务，写入本地历史，形成行为-成就闭环

### 风险与伦理
- 本应用非医疗器械，不替代专业诊断
- 在 `warning` 中继续提醒“何时应寻求专业帮助”

—— 版本：2025-11-04


