# 管理员登录系统 - 快速测试指南

## ✅ 系统状态检查

### 1. 检查后端服务

访问健康检查接口：
```
http://localhost:3001/health
```

预期响应：
```json
{
  "status": "ok",
  "timestamp": "2025-11-05T...",
  "uptime": 35.81
}
```

### 2. 测试登录API

使用curl或Postman测试：

```bash
curl -X POST http://localhost:3001/api/admin/login \
  -H "Content-Type: application/json" \
  -d "{\"username\":\"admin\",\"password\":\"admin123\"}"
```

预期响应：
```json
{
  "success": true,
  "token": "一串随机token...",
  "admin": {
    "id": 1,
    "username": "admin",
    "nickname": "系统管理员",
    "email": null
  }
}
```

---

## 🎯 完整测试流程

### Step 1: 访问登录页面

1. 打开浏览器
2. 访问：`http://localhost:3000/admin/login`
3. 应该看到登录页面

### Step 2: 测试登录

1. 输入用户名：`admin`
2. 输入密码：`admin123`
3. 点击"登录"
4. 应该自动跳转到 `/admin/dashboard`

### Step 3: 验证权限保护

1. 退出登录（点击右上角"退出登录"）
2. 尝试直接访问：`http://localhost:3000/admin/codes`
3. 应该自动跳转回登录页面
4. 这证明路由守卫正常工作

### Step 4: 测试激活码管理

1. 登录后进入"激活码管理"
2. 尝试创建一个新激活码
3. 检查网络请求是否携带 `Authorization` 头
4. 应该能正常创建

### Step 5: 测试批量创建

1. 点击"批量新建"按钮
2. 生成10个激活码
3. 提交创建
4. 应该能看到新创建的激活码

---

## 🔍 调试检查点

### 前端检查

1. **LocalStorage检查**
   - 按F12打开开发者工具
   - 进入Application → LocalStorage
   - 应该能看到 `admin_token` 和 `admin_info`

2. **网络请求检查**
   - 进入Network标签页
   - 查看管理后台的API请求
   - 检查Request Headers中是否有：
     ```
     Authorization: Bearer xxx...
     ```

3. **控制台检查**
   - 查看Console标签页
   - 不应该有错误信息

### 后端检查

1. **数据库表检查**

```sql
-- 查看管理员账号
SELECT * FROM admin_users;

-- 查看会话
SELECT * FROM admin_sessions;

-- 查看激活码（测试是否需要认证）
SELECT * FROM activation_codes LIMIT 5;
```

2. **后端日志检查**

查看终端输出，应该有类似日志：
```
2025-11-05T... - POST /api/admin/login
2025-11-05T... - GET /api/admin/codes
2025-11-05T... - GET /api/admin/stats
```

---

## 🐛 常见问题排查

### 问题1: 登录后立即退出

**排查步骤**:
1. 检查浏览器Console是否有错误
2. 检查Network中登录请求的响应
3. 确认token已保存到LocalStorage
4. 检查`/api/admin/me`接口是否返回401

### 问题2: 无法访问管理后台

**排查步骤**:
1. 确认后端服务在3001端口运行
2. 测试 `http://localhost:3001/health`
3. 检查跨域配置
4. 检查前端环境变量

### 问题3: API返回401未授权

**排查步骤**:
1. 检查请求头是否携带Authorization
2. 检查token是否过期
3. 重新登录获取新token
4. 检查后端authService是否正常

---

## 📊 测试清单

- [ ] 后端服务正常启动（3001端口）
- [ ] 前端服务正常启动（3000端口）
- [ ] 管理员表已创建（admin_users）
- [ ] 会话表已创建（admin_sessions）
- [ ] 默认管理员账号存在
- [ ] 登录页面可访问
- [ ] 登录功能正常
- [ ] Token保存到LocalStorage
- [ ] 路由守卫生效（未登录跳转）
- [ ] 管理后台可访问
- [ ] 用户信息显示正常
- [ ] API请求携带Authorization头
- [ ] 激活码列表可加载
- [ ] 创建激活码功能正常
- [ ] 批量创建功能正常
- [ ] 退出登录功能正常
- [ ] 退出后无法访问管理后台

---

## 🎉 测试成功标志

如果以上测试都通过，说明管理员登录系统已完美集成！

**核心功能**:
✅ 登录认证
✅ Token管理
✅ 权限保护
✅ 路由守卫
✅ 会话管理

**安全特性**:
✅ 密码加密
✅ Token验证
✅ 自动过期
✅ 前端防护

**用户体验**:
✅ 美观的登录页
✅ 用户信息显示
✅ 退出登录
✅ 自动跳转

