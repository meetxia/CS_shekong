# 激活码后台使用指南（MVP）

本文档说明如何在本项目中启用“激活码后台（增删改查 + 数据面板）”。

## 前置条件

- 已完成 `docs/06-数据库脚本/supabase_activation_setup.sql` 导入（表、RLS、统计视图、验证函数）
- 在 Supabase 项目中执行 `docs/06-数据库脚本/admin_functions.sql`（提供前端可调用的受权 RPC）
- `.env` 中配置：
  - `VITE_SUPABASE_URL`
  - `VITE_SUPABASE_ANON_KEY`

> 重要：MVP 方案直接在前端调用 SECURITY DEFINER RPC，仅适合内部/灰度。生产建议改造为 Edge Functions + Service Key。

## 入口

- 浏览器访问 `/admin`
  - 数据总览：`/admin/dashboard`
  - 激活码管理：`/admin/codes`

## 功能

- 数据总览：
  - 激活码总数、启用中、已过期、已撤销
  - 总激活次数、总使用次数
  - 按激活码聚合的激活/使用统计（来自视图 `activation_stats`）

- 激活码管理：
  - 列表、状态筛选、搜索（code/备注）
  - 新建/编辑（最大使用、每日上限、有效天数、过期时间、备注）
  - 撤销、删除

## 常见问题

- 无法创建/编辑/删除/撤销：
  - 原因：未在数据库侧创建 RPC。
  - 解决：在 Supabase SQL 编辑器执行 `docs/06-数据库脚本/admin_functions.sql`。

- 统计为空：
  - 确认已执行 `supabase_activation_setup.sql`，并存在 `activation_codes`/`activation_records` 数据。

## 安全提示（强烈建议）

- 正式环境请使用 Edge Functions（服务端）封装管理接口，前端仅调用边缘函数；
- 对 `activation_codes` 开启更严格的 RLS 策略，禁用匿名写入；
- 管理端加上简单的访问门禁（白名单 IP 或临时口令）。


