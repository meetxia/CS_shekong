# ç®¡ç†å‘˜ç™»å½•ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ‰ åŠŸèƒ½æ¦‚è¿°

å·²æˆåŠŸä¸ºç®¡ç†åå°æ·»åŠ å®Œæ•´çš„ç™»å½•è®¤è¯ç³»ç»Ÿï¼Œç°åœ¨åªæœ‰ç™»å½•çš„ç®¡ç†å‘˜æ‰èƒ½è®¿é—®åå°åŠŸèƒ½ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
node server.js
```

### 2. è®¿é—®ç™»å½•é¡µé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š**http://localhost:3000/admin/login**

### 3. ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`

âš ï¸ **é‡è¦**: é¦–æ¬¡ç™»å½•åè¯·åŠ¡å¿…ä¿®æ”¹å¯†ç ï¼

---

## ğŸ“‹ åŠŸèƒ½æ¸…å•

### âœ… å·²å®ç°åŠŸèƒ½

#### åç«¯åŠŸèƒ½
1. **ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ**
   - `admin_users` è¡¨ - ç®¡ç†å‘˜è´¦å·
   - `admin_sessions` è¡¨ - ç™»å½•ä¼šè¯ç®¡ç†
   - å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆbcryptï¼‰
   - Tokenä¼šè¯æœºåˆ¶ï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰

2. **è®¤è¯API**
   - `POST /api/admin/login` - ç®¡ç†å‘˜ç™»å½•
   - `POST /api/admin/logout` - ç®¡ç†å‘˜ç™»å‡º
   - `GET /api/admin/me` - è·å–å½“å‰ç™»å½•ä¿¡æ¯
   - `POST /api/admin/change-password` - ä¿®æ”¹å¯†ç 

3. **æƒé™ä¿æŠ¤**
   - æ‰€æœ‰ `/api/admin/*` ç®¡ç†æ¥å£éƒ½éœ€è¦è®¤è¯
   - TokenéªŒè¯ä¸­é—´ä»¶
   - è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯

#### å‰ç«¯åŠŸèƒ½
1. **ç™»å½•é¡µé¢**
   - ç²¾ç¾çš„ç™»å½•ç•Œé¢
   - è¡¨å•éªŒè¯
   - é”™è¯¯æç¤º

2. **è·¯ç”±å®ˆå«**
   - æœªç™»å½•è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
   - Tokenè‡ªåŠ¨æºå¸¦
   - ç™»å½•çŠ¶æ€æŒä¹…åŒ–

3. **ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º**
   - ä¾§è¾¹æ æ˜¾ç¤ºç®¡ç†å‘˜å¤´åƒå’Œæ˜µç§°
   - é€€å‡ºç™»å½•æŒ‰é’®
   - ä¼šè¯è‡ªåŠ¨éªŒè¯

---

## ğŸ” å®‰å…¨ç‰¹æ€§

### 1. å¯†ç å®‰å…¨
- ä½¿ç”¨ `bcrypt` åŠ å¯†å­˜å‚¨
- ç›å€¼è½®æ¬¡ï¼š10
- å¯†ç ä¸å¯é€†å‘è§£å¯†

### 2. ä¼šè¯ç®¡ç†
- Tokenéšæœºç”Ÿæˆï¼ˆ64å­—ç¬¦ï¼‰
- ä¼šè¯æœ‰æ•ˆæœŸï¼š7å¤©
- æ”¯æŒå¤šè®¾å¤‡ç™»å½•
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯

### 3. APIä¿æŠ¤
- æ‰€æœ‰ç®¡ç†æ¥å£éƒ½éœ€è¦è®¤è¯
- TokenéªŒè¯ä¸­é—´ä»¶
- 401æœªæˆæƒè‡ªåŠ¨è¿”å›

### 4. å‰ç«¯é˜²æŠ¤
- è·¯ç”±å®ˆå«ä¿æŠ¤
- LocalStorageå­˜å‚¨Token
- è‡ªåŠ¨è·³è½¬ç™»å½•é¡µ

---

## ğŸ“– ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šé¦–æ¬¡ç™»å½•

1. è®¿é—® `http://localhost:3000/admin/login`
2. è¾“å…¥é»˜è®¤è´¦å·ï¼š`admin` / `admin123`
3. ç‚¹å‡»"ç™»å½•"
4. è‡ªåŠ¨è·³è½¬åˆ°ç®¡ç†åå°
5. **å»ºè®®ç«‹å³ä¿®æ”¹å¯†ç **

### åœºæ™¯2ï¼šä¿®æ”¹å¯†ç 

ç›®å‰ä¿®æ”¹å¯†ç åŠŸèƒ½éœ€è¦è°ƒç”¨APIï¼š

```javascript
import { changePassword } from '@/utils/adminAuth'

// ä¿®æ”¹å¯†ç 
await changePassword('æ—§å¯†ç ', 'æ–°å¯†ç ')
// ä¿®æ”¹æˆåŠŸåä¼šè‡ªåŠ¨æ¸…é™¤tokenï¼Œéœ€è¦é‡æ–°ç™»å½•
```

**è®¡åˆ’æ·»åŠ **: åœ¨ç®¡ç†åå°å¢åŠ å¯†ç ä¿®æ”¹é¡µé¢

### åœºæ™¯3ï¼šé€€å‡ºç™»å½•

1. ç‚¹å‡»å³ä¸Šè§’"é€€å‡ºç™»å½•"æŒ‰é’®
2. ç¡®è®¤é€€å‡º
3. è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

### åœºæ™¯4ï¼šä¼šè¯è¿‡æœŸ

- Tokenè¿‡æœŸåï¼ˆ7å¤©ï¼‰
- è®¿é—®ç®¡ç†åå°æ—¶è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
- é‡æ–°ç™»å½•å³å¯

### åœºæ™¯5ï¼šåˆ›å»ºæ–°ç®¡ç†å‘˜

ç›®å‰éœ€è¦é€šè¿‡Node.jsè„šæœ¬åˆ›å»ºï¼š

```javascript
// backend/createAdmin.js
const { createAdminUser } = require('./authService');

(async () => {
  const result = await createAdminUser(
    'newadmin',      // ç”¨æˆ·å
    'password123',   // å¯†ç 
    'æ–°ç®¡ç†å‘˜',      // æ˜µç§°
    'admin@example.com' // é‚®ç®±ï¼ˆå¯é€‰ï¼‰
  );
  console.log(result);
})();
```

**è®¡åˆ’æ·»åŠ **: åœ¨ç®¡ç†åå°å¢åŠ ç®¡ç†å‘˜ç®¡ç†é¡µé¢

---

## ğŸ—‚ï¸ ä»£ç ç»“æ„

### åç«¯

```
backend/
â”œâ”€â”€ routes/                  # è·¯ç”±æ¨¡å—
â”‚   â”œâ”€â”€ authRoutes.js       # è®¤è¯è·¯ç”±
â”‚   â”œâ”€â”€ adminRoutes.js      # ç®¡ç†åå°è·¯ç”±
â”‚   â”œâ”€â”€ activationRoutes.js # æ¿€æ´»ç éªŒè¯è·¯ç”±
â”‚   â”œâ”€â”€ aiRoutes.js         # AIåˆ†æè·¯ç”±
â”‚   â””â”€â”€ statsRoutes.js      # ç»Ÿè®¡è·¯ç”±
â”œâ”€â”€ authService.js          # è®¤è¯æœåŠ¡
â”œâ”€â”€ activationService.js    # æ¿€æ´»ç æœåŠ¡
â”œâ”€â”€ aiService.js            # AIæœåŠ¡
â”œâ”€â”€ db.js                   # æ•°æ®åº“è¿æ¥
â”œâ”€â”€ server.js               # ä¸»æœåŠ¡å™¨ï¼ˆ<200è¡Œï¼‰
â”œâ”€â”€ initAdmin.js            # åˆå§‹åŒ–ç®¡ç†å‘˜è„šæœ¬
â””â”€â”€ admin_auth.sql          # ç®¡ç†å‘˜è¡¨SQL
```

### å‰ç«¯

```
src/
â”œâ”€â”€ views/admin/
â”‚   â”œâ”€â”€ AdminLogin.vue      # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ AdminLayout.vue     # ç®¡ç†åå°å¸ƒå±€
â”‚   â”œâ”€â”€ AdminDashboard.vue  # æ•°æ®æ€»è§ˆ
â”‚   â””â”€â”€ AdminCodes.vue      # æ¿€æ´»ç ç®¡ç†
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ adminAuth.js        # è®¤è¯å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ backendActivation.js # æ¿€æ´»ç APIï¼ˆå·²åŠ è®¤è¯ï¼‰
â””â”€â”€ router/
    â””â”€â”€ index.js            # è·¯ç”±é…ç½®ï¼ˆå«è·¯ç”±å®ˆå«ï¼‰
```

---

## ğŸ”§ APIæ–‡æ¡£

### è®¤è¯ç›¸å…³API

#### 1. ç®¡ç†å‘˜ç™»å½•

```http
POST /api/admin/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "token": "abc123...",
  "admin": {
    "id": 1,
    "username": "admin",
    "nickname": "ç³»ç»Ÿç®¡ç†å‘˜",
    "email": null
  }
}
```

#### 2. ç®¡ç†å‘˜ç™»å‡º

```http
POST /api/admin/logout
Authorization: Bearer {token}
```

#### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```http
GET /api/admin/me
Authorization: Bearer {token}
```

#### 4. ä¿®æ”¹å¯†ç 

```http
POST /api/admin/change-password
Authorization: Bearer {token}
Content-Type: application/json

{
  "oldPassword": "admin123",
  "newPassword": "newpassword123"
}
```

### ç®¡ç†åå°APIï¼ˆéœ€è®¤è¯ï¼‰

æ‰€æœ‰ä»¥ä¸‹æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ï¼š
```
Authorization: Bearer {token}
```

- `GET /api/admin/codes` - è·å–æ¿€æ´»ç åˆ—è¡¨
- `POST /api/admin/codes` - åˆ›å»ºæ¿€æ´»ç 
- `POST /api/admin/codes/bulk` - æ‰¹é‡åˆ›å»º
- `PUT /api/admin/codes/:id` - æ›´æ–°æ¿€æ´»ç 
- `POST /api/admin/codes/:id/revoke` - æ’¤é”€æ¿€æ´»ç 
- `DELETE /api/admin/codes/:id` - åˆ é™¤æ¿€æ´»ç 
- `GET /api/admin/stats` - è·å–ç»Ÿè®¡æ•°æ®
- `GET /api/admin/records/:code` - è·å–æ¿€æ´»è®°å½•

---

## ğŸ¨ å‰ç«¯é›†æˆ

### ä½¿ç”¨è®¤è¯å·¥å…·å‡½æ•°

```javascript
import { 
  adminLogin, 
  adminLogout, 
  getCurrentAdmin, 
  isLoggedIn,
  getToken,
  getAuthHeaders 
} from '@/utils/adminAuth'

// ç™»å½•
const result = await adminLogin('admin', 'admin123')

// æ£€æŸ¥ç™»å½•çŠ¶æ€
if (isLoggedIn()) {
  // å·²ç™»å½•
}

// è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
const admin = await getCurrentAdmin()

// ç™»å‡º
await adminLogout()

// åœ¨APIè¯·æ±‚ä¸­ä½¿ç”¨è®¤è¯å¤´
fetch('/api/admin/codes', {
  headers: getAuthHeaders()
})
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - é»˜è®¤å¯†ç  `admin123` ä»…ç”¨äºæµ‹è¯•
   - ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹

2. **HTTPSéƒ¨ç½²**
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨HTTPS
   - é˜²æ­¢Tokenè¢«æˆªè·

3. **å®šæœŸæ›´æ¢å¯†ç **
   - å»ºè®®å®šæœŸä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
   - å¯è®¾ç½®å¯†ç ç­–ç•¥

4. **IPç™½åå•**
   - è€ƒè™‘æ·»åŠ IPé™åˆ¶
   - é™åˆ¶ç®¡ç†åå°è®¿é—®æ¥æº

5. **æ—¥å¿—è®°å½•**
   - è®°å½•ç™»å½•æ—¥å¿—
   - ç›‘æ§å¼‚å¸¸ç™»å½•

### æ€§èƒ½ä¼˜åŒ–

1. **ä¼šè¯æ¸…ç†**
   - æ¯å°æ—¶è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè¯
   - é˜²æ­¢ä¼šè¯è¡¨è¿‡å¤§

2. **Tokenç¼“å­˜**
   - å‰ç«¯LocalStorageå­˜å‚¨Token
   - å‡å°‘æœåŠ¡å™¨éªŒè¯å‹åŠ›

3. **è¿æ¥æ± **
   - MySQLè¿æ¥æ± é…ç½®
   - æé«˜æ•°æ®åº“æ€§èƒ½

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç™»å½•åç«‹å³è·³è½¬åˆ°ç™»å½•é¡µï¼Ÿ

**åŸå› **: Tokenæœªæ­£ç¡®ä¿å­˜æˆ–è·¯ç”±å®ˆå«é…ç½®é”™è¯¯

**è§£å†³**:
1. æ£€æŸ¥æµè§ˆå™¨LocalStorageä¸­æ˜¯å¦æœ‰ `admin_token`
2. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ

### Q2: æç¤º"ä¼šè¯å·²å¤±æ•ˆ"ï¼Ÿ

**åŸå› **: Tokenè¿‡æœŸæˆ–è¢«åˆ é™¤

**è§£å†³**:
1. é‡æ–°ç™»å½•
2. æ£€æŸ¥Tokenæœ‰æ•ˆæœŸï¼ˆé»˜è®¤7å¤©ï¼‰
3. ç¡®è®¤æ²¡æœ‰æ‰‹åŠ¨æ¸…é™¤LocalStorage

### Q3: ä¿®æ”¹å¯†ç åæ— æ³•ç™»å½•ï¼Ÿ

**åŸå› **: ä¿®æ”¹å¯†ç åTokenè¢«æ¸…é™¤ï¼ˆæ­£å¸¸è¡Œä¸ºï¼‰

**è§£å†³**:
- ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•å³å¯

### Q4: åç«¯æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Ÿ

**åŸå› **: å¯èƒ½æ˜¯æ•°æ®åº“è¿æ¥å¤±è´¥æˆ–ç«¯å£è¢«å ç”¨

**è§£å†³**:
1. æ£€æŸ¥MySQLæ˜¯å¦è¿è¡Œ
2. æ£€æŸ¥`.env`é…ç½®
3. è¿è¡Œ `node initAdmin.js` åˆå§‹åŒ–è¡¨
4. æ£€æŸ¥3001ç«¯å£æ˜¯å¦è¢«å ç”¨

### Q5: å‰ç«¯æ— æ³•è®¿é—®åç«¯APIï¼Ÿ

**åŸå› **: è·¨åŸŸæˆ–åç«¯æœªå¯åŠ¨

**è§£å†³**:
1. ç¡®è®¤åç«¯æœåŠ¡åœ¨3001ç«¯å£è¿è¡Œ
2. æ£€æŸ¥CORSé…ç½®
3. æ£€æŸ¥ç¯å¢ƒå˜é‡ `VITE_BACKEND_URL`

---

## ğŸ”„ åç»­è®¡åˆ’

### è®¡åˆ’åŠŸèƒ½

1. **å¯†ç ä¿®æ”¹é¡µé¢**
   - [ ] åœ¨ç®¡ç†åå°æ·»åŠ å¯†ç ä¿®æ”¹é¡µé¢
   - [ ] å¯†ç å¼ºåº¦éªŒè¯
   - [ ] ä¿®æ”¹å†å²è®°å½•

2. **ç®¡ç†å‘˜ç®¡ç†**
   - [ ] ç®¡ç†å‘˜åˆ—è¡¨é¡µé¢
   - [ ] åˆ›å»º/ç¼–è¾‘/åˆ é™¤ç®¡ç†å‘˜
   - [ ] è§’è‰²æƒé™ç®¡ç†

3. **ç™»å½•æ—¥å¿—**
   - [ ] ç™»å½•å†å²è®°å½•
   - [ ] å¼‚å¸¸ç™»å½•å‘Šè­¦
   - [ ] ç™»å½•IPè®°å½•

4. **ä¼šè¯ç®¡ç†**
   - [ ] æŸ¥çœ‹å½“å‰åœ¨çº¿ä¼šè¯
   - [ ] å¼ºåˆ¶ä¸‹çº¿åŠŸèƒ½
   - [ ] å•ç‚¹ç™»å½•ï¼ˆå¯é€‰ï¼‰

5. **ä¸¤æ­¥éªŒè¯**
   - [ ] é‚®ç®±éªŒè¯ç 
   - [ ] çŸ­ä¿¡éªŒè¯ç 
   - [ ] TOTPï¼ˆGoogle Authenticatorï¼‰

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹åç«¯æ—¥å¿—
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
3. ç¡®è®¤æ•°æ®åº“è¿æ¥
4. éªŒè¯ç¯å¢ƒé…ç½®

**æµ‹è¯•æ­¥éª¤**:

```bash
# 1. æµ‹è¯•æ•°æ®åº“
cd backend
node initAdmin.js

# 2. å¯åŠ¨åç«¯
node server.js

# 3. è®¿é—®å¥åº·æ£€æŸ¥
curl http://localhost:3001/health

# 4. æµ‹è¯•ç™»å½•API
curl -X POST http://localhost:3001/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

---

## âœ¨ æ€»ç»“

âœ… **å·²å®Œæˆ**:
- å®Œæ•´çš„ç®¡ç†å‘˜è®¤è¯ç³»ç»Ÿ
- å‰åç«¯ç™»å½•é›†æˆ
- è·¯ç”±æƒé™ä¿æŠ¤
- Tokenä¼šè¯ç®¡ç†
- ä»£ç æ¨¡å—åŒ–ï¼ˆæ¯ä¸ªæ–‡ä»¶<500è¡Œï¼‰

ğŸ¯ **ä½¿ç”¨æµç¨‹**:
1. è®¿é—® `/admin/login` ç™»å½•
2. ä½¿ç”¨é»˜è®¤è´¦å·æˆ–åˆ›å»ºæ–°è´¦å·
3. ç™»å½•åè‡ªåŠ¨è·³è½¬ç®¡ç†åå°
4. æ‰€æœ‰ç®¡ç†åŠŸèƒ½å—ä¿æŠ¤
5. é€€å‡ºç™»å½•æ¸…é™¤ä¼šè¯

ğŸ”’ **å®‰å…¨ä¿éšœ**:
- å¯†ç åŠ å¯†å­˜å‚¨
- Tokenè®¤è¯æœºåˆ¶
- è·¯ç”±å®ˆå«ä¿æŠ¤
- è‡ªåŠ¨ä¼šè¯æ¸…ç†

