<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIåˆ†ææµ‹è¯•</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }
    .status {
      display: inline-block;
      padding: 5px 12px;
      border-radius: 4px;
      font-weight: 600;
      margin-left: 10px;
    }
    .status.loading {
      background: #FFC107;
      color: #000;
    }
    .status.success {
      background: #4CAF50;
      color: white;
    }
    .status.error {
      background: #f44336;
      color: white;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      background: white;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    button {
      background: #2196F3;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover {
      background: #1976D2;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .config {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    .config-item {
      margin: 8px 0;
    }
    .config-label {
      font-weight: 600;
      color: #1976D2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¤– AIåˆ†æåŠŸèƒ½æµ‹è¯•å·¥å…·</h1>
    
    <div class="config">
      <h3>å½“å‰é…ç½®</h3>
      <div class="config-item">
        <span class="config-label">API URL:</span>
        <span id="apiUrl">åŠ è½½ä¸­...</span>
      </div>
      <div class="config-item">
        <span class="config-label">æ¨¡å‹:</span>
        <span id="model">åŠ è½½ä¸­...</span>
      </div>
      <div class="config-item">
        <span class="config-label">API Key:</span>
        <span id="apiKey">åŠ è½½ä¸­...</span>
      </div>
    </div>

    <!-- æµ‹è¯•1: æ£€æŸ¥AI APIé…ç½® -->
    <div class="test-section">
      <h3>
        æµ‹è¯•1: æ£€æŸ¥AI APIé…ç½®
        <span id="status1" class="status loading">ç­‰å¾…æµ‹è¯•</span>
      </h3>
      <button onclick="testConfig()">å¼€å§‹æµ‹è¯•</button>
      <div id="result1" class="result" style="display:none;"></div>
    </div>

    <!-- æµ‹è¯•2: è°ƒç”¨AIç”Ÿæˆåˆ†æ -->
    <div class="test-section">
      <h3>
        æµ‹è¯•2: è°ƒç”¨AIç”Ÿæˆåˆ†æ
        <span id="status2" class="status loading">ç­‰å¾…æµ‹è¯•</span>
      </h3>
      <button onclick="testAIGeneration()">å¼€å§‹æµ‹è¯•</button>
      <div id="result2" class="result" style="display:none;"></div>
    </div>

    <!-- æµ‹è¯•3: æ£€æŸ¥æœ¬åœ°é™çº§æ–¹æ¡ˆ -->
    <div class="test-section">
      <h3>
        æµ‹è¯•3: æœ¬åœ°å¢å¼ºåˆ†æï¼ˆé™çº§æ–¹æ¡ˆï¼‰
        <span id="status3" class="status loading">ç­‰å¾…æµ‹è¯•</span>
      </h3>
      <button onclick="testLocalFallback()">å¼€å§‹æµ‹è¯•</button>
      <div id="result3" class="result" style="display:none;"></div>
    </div>

    <!-- æµ‹è¯•4: æŸ¥çœ‹å½“å‰æŠ¥å‘Šæ•°æ® -->
    <div class="test-section">
      <h3>
        æµ‹è¯•4: æŸ¥çœ‹å½“å‰æŠ¥å‘Šä¸­çš„AIæ•°æ®
        <span id="status4" class="status loading">ç­‰å¾…æµ‹è¯•</span>
      </h3>
      <button onclick="testCurrentReport()">æŸ¥çœ‹æŠ¥å‘Š</button>
      <div id="result4" class="result" style="display:none;"></div>
    </div>

    <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 8px;">
      <h4>ğŸ’¡ è¯´æ˜</h4>
      <ul>
        <li>æµ‹è¯•1ä¼šæ£€æŸ¥AI APIçš„é…ç½®æ˜¯å¦æ­£ç¡®</li>
        <li>æµ‹è¯•2ä¼šå®é™…è°ƒç”¨AI APIç”Ÿæˆåˆ†ææŠ¥å‘Š</li>
        <li>æµ‹è¯•3ä¼šæµ‹è¯•æœ¬åœ°é™çº§æ–¹æ¡ˆï¼ˆä¸ä¾èµ–AIï¼‰</li>
        <li>æµ‹è¯•4ä¼šæ˜¾ç¤ºä½ å½“å‰æµ‹è¯•æŠ¥å‘Šä¸­ä½¿ç”¨çš„AIæ•°æ®</li>
      </ul>
    </div>
  </div>

  <script type="module">
    // å¯¼å…¥AIæœåŠ¡
    import { generatePersonalizedAnalysis, generateEnhancedAnalysis } from '../src/utils/aiService.js';

    // æ˜¾ç¤ºé…ç½®ä¿¡æ¯
    const AI_CONFIG = {
      apiKey: import.meta.env.VITE_AI_API_KEY || 'sk-neZiqN36Qh4HbF7WB3633aC322844cB09c5474D64d5fA657',
      apiUrl: import.meta.env.VITE_AI_API_URL || 'https://dpapi.cn/v1/chat/completions',
      model: import.meta.env.VITE_AI_MODEL || 'claude-4.5-sonnet'
    };

    document.getElementById('apiUrl').textContent = AI_CONFIG.apiUrl;
    document.getElementById('model').textContent = AI_CONFIG.model;
    document.getElementById('apiKey').textContent = AI_CONFIG.apiKey.substring(0, 20) + '...';

    // æµ‹è¯•æ•°æ®
    const mockReport = {
      totalScore: 65,
      level: { name: 'ä¸­åº¦ç¤¾äº¤ç„¦è™‘' },
      type: { name: 'é¢„æ¼”å‹ç¤¾æ' },
      dimensions: [
        { name: 'ç¤¾äº¤åœºæ™¯ææƒ§', score: 18, maxScore: 25, percentage: 72, level: { level: 'åé«˜' } },
        { name: 'å›é¿è¡Œä¸ºç¨‹åº¦', score: 15, maxScore: 25, percentage: 60, level: { level: 'ä¸­é«˜' } },
        { name: 'é¢„æœŸç„¦è™‘å¼ºåº¦', score: 20, maxScore: 25, percentage: 80, level: { level: 'åé«˜' } },
        { name: 'è´Ÿé¢è¯„ä»·ææƒ§', score: 17, maxScore: 25, percentage: 68, level: { level: 'ä¸­é«˜' } },
        { name: 'ç¤¾äº¤åååˆ', score: 19, maxScore: 25, percentage: 76, level: { level: 'åé«˜' } },
        { name: 'åŠŸèƒ½æŸå®³ç¨‹åº¦', score: 14, maxScore: 25, percentage: 56, level: { level: 'ä¸­ç­‰' } }
      ]
    };

    const mockAnswers = {
      1: 4, 2: 3, 3: 5, 4: 4, 5: 3, 6: 4, 7: 5, 8: 3, 9: 4, 10: 4,
      11: 3, 12: 4, 13: 5, 14: 3, 15: 4, 16: 4, 17: 3, 18: 5, 19: 4, 20: 3,
      21: 4, 22: 3, 23: 4, 24: 5, 25: 3, 26: 4, 27: 3, 28: 4, 29: 3, 30: 4,
      31: 3, 32: 4, 33: 3
    };

    const mockBasicInfo = {
      age: 'college',
      gender: 'female',
      occupation: 'student',
      social_frequency: 'occasional'
    };

    // æµ‹è¯•1: æ£€æŸ¥é…ç½®
    window.testConfig = function() {
      const statusEl = document.getElementById('status1');
      const resultEl = document.getElementById('result1');
      
      statusEl.className = 'status loading';
      statusEl.textContent = 'æµ‹è¯•ä¸­...';
      resultEl.style.display = 'block';
      
      let result = 'âœ… é…ç½®æ£€æŸ¥ç»“æœï¼š\n\n';
      result += `API URL: ${AI_CONFIG.apiUrl}\n`;
      result += `æ¨¡å‹: ${AI_CONFIG.model}\n`;
      result += `API Key: ${AI_CONFIG.apiKey.substring(0, 20)}...\n\n`;
      
      if (AI_CONFIG.apiKey && AI_CONFIG.apiUrl && AI_CONFIG.model) {
        result += 'âœ… æ‰€æœ‰é…ç½®é¡¹éƒ½å·²è®¾ç½®\n';
        statusEl.className = 'status success';
        statusEl.textContent = 'é…ç½®æ­£å¸¸';
      } else {
        result += 'âŒ é…ç½®ä¸å®Œæ•´\n';
        statusEl.className = 'status error';
        statusEl.textContent = 'é…ç½®é”™è¯¯';
      }
      
      resultEl.textContent = result;
    };

    // æµ‹è¯•2: AIç”Ÿæˆ
    window.testAIGeneration = async function() {
      const statusEl = document.getElementById('status2');
      const resultEl = document.getElementById('result2');
      
      statusEl.className = 'status loading';
      statusEl.textContent = 'è°ƒç”¨ä¸­...';
      resultEl.style.display = 'block';
      resultEl.textContent = 'æ­£åœ¨è°ƒç”¨AI APIï¼Œè¯·ç¨å€™ï¼ˆæœ€å¤š30ç§’ï¼‰...\n';
      
      const startTime = Date.now();
      
      try {
        const result = await generatePersonalizedAnalysis(mockReport, mockAnswers, mockBasicInfo);
        const duration = Date.now() - startTime;
        
        if (result) {
          let output = `âœ… AIç”ŸæˆæˆåŠŸï¼(è€—æ—¶: ${duration}ms)\n\n`;
          output += `ç±»å‹åç§°: ${result.name}\n`;
          output += `è‹±æ–‡åç§°: ${result.englishName}\n\n`;
          output += `æ ¸å¿ƒç‰¹å¾ (${result.features.length}æ¡):\n`;
          result.features.forEach((f, i) => {
            output += `${i + 1}. ${f}\n`;
          });
          output += `\nå¿ƒç†æ ¹æº (${result.rootCauses.length}æ¡):\n`;
          result.rootCauses.forEach((c, i) => {
            output += `${i + 1}. ${c.title}\n   ${c.desc}\n`;
          });
          output += `\næ­£å‘é‡æ„:\n${result.positiveReframe}\n\n`;
          output += `å®Œæ•´æ•°æ®:\n${JSON.stringify(result, null, 2)}`;
          
          resultEl.textContent = output;
          statusEl.className = 'status success';
          statusEl.textContent = 'AIç”ŸæˆæˆåŠŸ';
        } else {
          resultEl.textContent = 'âŒ AIè¿”å›nullï¼ˆå¯èƒ½æ˜¯APIè°ƒç”¨å¤±è´¥æˆ–è¶…æ—¶ï¼‰';
          statusEl.className = 'status error';
          statusEl.textContent = 'AIè¿”å›null';
        }
      } catch (error) {
        const duration = Date.now() - startTime;
        resultEl.textContent = `âŒ AIç”Ÿæˆå¤±è´¥ (è€—æ—¶: ${duration}ms)\n\né”™è¯¯ä¿¡æ¯:\n${error.message}\n\n${error.stack}`;
        statusEl.className = 'status error';
        statusEl.textContent = 'AIç”Ÿæˆå¤±è´¥';
      }
    };

    // æµ‹è¯•3: æœ¬åœ°é™çº§
    window.testLocalFallback = function() {
      const statusEl = document.getElementById('status3');
      const resultEl = document.getElementById('result3');
      
      statusEl.className = 'status loading';
      statusEl.textContent = 'ç”Ÿæˆä¸­...';
      resultEl.style.display = 'block';
      
      try {
        const result = generateEnhancedAnalysis(mockReport, mockAnswers, mockBasicInfo);
        
        let output = `âœ… æœ¬åœ°å¢å¼ºåˆ†ææˆåŠŸï¼\n\n`;
        output += `ç±»å‹åç§°: ${result.name}\n`;
        output += `è‹±æ–‡åç§°: ${result.englishName}\n\n`;
        output += `æ ¸å¿ƒç‰¹å¾ (${result.features.length}æ¡):\n`;
        result.features.forEach((f, i) => {
          output += `${i + 1}. ${f}\n`;
        });
        output += `\nå¿ƒç†æ ¹æº (${result.rootCauses.length}æ¡):\n`;
        result.rootCauses.forEach((c, i) => {
          output += `${i + 1}. ${c.title}\n   ${c.desc}\n`;
        });
        output += `\næ­£å‘é‡æ„:\n${result.positiveReframe}\n\n`;
        output += `å®Œæ•´æ•°æ®:\n${JSON.stringify(result, null, 2)}`;
        
        resultEl.textContent = output;
        statusEl.className = 'status success';
        statusEl.textContent = 'æœ¬åœ°ç”ŸæˆæˆåŠŸ';
      } catch (error) {
        resultEl.textContent = `âŒ æœ¬åœ°ç”Ÿæˆå¤±è´¥\n\né”™è¯¯ä¿¡æ¯:\n${error.message}\n\n${error.stack}`;
        statusEl.className = 'status error';
        statusEl.textContent = 'æœ¬åœ°ç”Ÿæˆå¤±è´¥';
      }
    };

    // æµ‹è¯•4: æŸ¥çœ‹å½“å‰æŠ¥å‘Š
    window.testCurrentReport = function() {
      const statusEl = document.getElementById('status4');
      const resultEl = document.getElementById('result4');
      
      statusEl.className = 'status loading';
      statusEl.textContent = 'è¯»å–ä¸­...';
      resultEl.style.display = 'block';
      
      try {
        const savedReport = localStorage.getItem('test_report');
        
        if (savedReport) {
          const report = JSON.parse(savedReport);
          
          let output = `âœ… æ‰¾åˆ°æµ‹è¯•æŠ¥å‘Šæ•°æ®\n\n`;
          output += `æ€»åˆ†: ${report.totalScore}\n`;
          output += `ç­‰çº§: ${report.level.name}\n`;
          output += `æ˜¯å¦AIç”Ÿæˆ: ${report.aiGenerated ? 'æ˜¯' : 'å¦ï¼ˆä½¿ç”¨æœ¬åœ°å¢å¼ºè§„åˆ™ï¼‰'}\n\n`;
          output += `ç±»å‹ä¿¡æ¯:\n`;
          output += `  åç§°: ${report.type.name}\n`;
          output += `  è‹±æ–‡: ${report.type.englishName}\n`;
          output += `  ç‰¹å¾æ•°: ${report.type.features.length}\n`;
          output += `  æ ¹æºæ•°: ${report.type.rootCauses.length}\n\n`;
          output += `å®Œæ•´ç±»å‹æ•°æ®:\n${JSON.stringify(report.type, null, 2)}`;
          
          resultEl.textContent = output;
          statusEl.className = 'status success';
          statusEl.textContent = report.aiGenerated ? 'ä½¿ç”¨AIåˆ†æ' : 'ä½¿ç”¨æœ¬åœ°åˆ†æ';
        } else {
          resultEl.textContent = 'âŒ æœªæ‰¾åˆ°æµ‹è¯•æŠ¥å‘Šæ•°æ®\n\nè¯·å…ˆå®Œæˆä¸€æ¬¡æµ‹è¯•ï¼Œç„¶åå†æŸ¥çœ‹æŠ¥å‘Šã€‚';
          statusEl.className = 'status error';
          statusEl.textContent = 'æœªæ‰¾åˆ°æŠ¥å‘Š';
        }
      } catch (error) {
        resultEl.textContent = `âŒ è¯»å–æŠ¥å‘Šå¤±è´¥\n\né”™è¯¯ä¿¡æ¯:\n${error.message}`;
        statusEl.className = 'status error';
        statusEl.textContent = 'è¯»å–å¤±è´¥';
      }
    };
  </script>
</body>
</html>

