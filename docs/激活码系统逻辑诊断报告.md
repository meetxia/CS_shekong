# æ¿€æ´»ç ç³»ç»Ÿé€»è¾‘è¯Šæ–­æŠ¥å‘Š

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

ç”¨æˆ·éœ€æ±‚ï¼š
1. âœ… åˆ›å»º7å¤©æ¿€æ´»ç ï¼Œæ¯å¤©åªèƒ½ç”¨3æ¬¡
2. âœ… ç”¨æˆ·æ¿€æ´»æ—¶ï¼Œæ¿€æ´»ç å¼€å§‹å€’è®¡æ—¶
3. âœ… åå°è®¡ç®—æ—¶é—´
4. âœ… æ¯æ¬¡æµ‹è¯•æ‰£ä¸€æ¬¡æµ‹è¯•æ¬¡æ•°
5. âœ… æ¯å¤©æœ€å¤šåªèƒ½æµ‹è¯•3æ¬¡
6. âœ… æ—¶é—´ç»“æŸåæ¿€æ´»ç å¤±æ•ˆ

## ğŸ” ç³»ç»Ÿæ¶æ„åˆ†æ

### 1. æ•°æ®åº“ç»“æ„ï¼ˆ`backend/database.sql`ï¼‰

#### activation_codes è¡¨ï¼ˆæ¿€æ´»ç ä¸»è¡¨ï¼‰
```sql
- code VARCHAR(14)           -- æ¿€æ´»ç 
- status VARCHAR(20)          -- çŠ¶æ€: active/used/expired/revoked
- max_uses INT DEFAULT 1      -- æœ€å¤§ä½¿ç”¨æ¬¡æ•°ï¼ˆå¯ä»¥è¢«å¤šå°‘ä¸ªè®¾å¤‡æ¿€æ´»ï¼‰
- current_uses INT DEFAULT 0  -- å½“å‰å·²æ¿€æ´»è®¾å¤‡æ•°
- validity_days INT DEFAULT 7 -- âœ… æœ‰æ•ˆå¤©æ•°ï¼ˆç”¨æˆ·æ¿€æ´»åå¯ç”¨å¤©æ•°ï¼‰
- daily_limit INT DEFAULT 3   -- âœ… æ¯æ—¥ä½¿ç”¨é™åˆ¶
- expires_at DATETIME         -- âš ï¸ æ¿€æ´»ç æœ¬èº«çš„è¿‡æœŸæ—¶é—´ï¼ˆå¯æ¿€æ´»æˆªæ­¢æ—¥æœŸï¼‰
```

#### activation_records è¡¨ï¼ˆæ¿€æ´»è®°å½•è¡¨ï¼‰
```sql
- code_id INT                 -- å…³è”çš„æ¿€æ´»ç ID
- activation_code VARCHAR(14) -- æ¿€æ´»ç 
- user_device_id VARCHAR(255) -- è®¾å¤‡æ ‡è¯†
- activated_at DATETIME       -- âœ… æ¿€æ´»æ—¶é—´ï¼ˆå¼€å§‹å€’è®¡æ—¶çš„èµ·ç‚¹ï¼‰
- expires_at DATETIME         -- âœ… æœ¬æ¬¡æ¿€æ´»çš„è¿‡æœŸæ—¶é—´ï¼ˆactivated_at + validity_daysï¼‰
- usage_count INT DEFAULT 0   -- âœ… å·²ä½¿ç”¨æ€»æ¬¡æ•°
- last_used_at DATETIME       -- æœ€åä½¿ç”¨æ—¶é—´
- usage_by_date JSON          -- âœ… æŒ‰æ—¥æœŸç»Ÿè®¡ä½¿ç”¨æ¬¡æ•° {"2025-11-05": 2, "2025-11-06": 3}
```

**âœ… æ•°æ®åº“ç»“æ„è®¾è®¡åˆç†ï¼Œæ”¯æŒæ‰€æœ‰éœ€æ±‚**

---

### 2. åç«¯é€»è¾‘åˆ†æï¼ˆ`backend/activationService.js`ï¼‰

#### 2.1 åˆ›å»ºæ¿€æ´»ç  `createActivationCode()`

```javascript:backend/activationService.js
// ç¬¬308-320è¡Œ
const [result] = await pool.query(
  `INSERT INTO activation_codes 
   (code, max_uses, daily_limit, validity_days, expires_at, notes, created_by) 
   VALUES (?, ?, ?, ?, ?, ?, ?)`,
  [
    code,
    data.max_uses || 1,           // å¯æ¿€æ´»è®¾å¤‡æ•°ï¼Œé»˜è®¤1
    data.daily_limit || 3,        // âœ… æ¯æ—¥é™åˆ¶ï¼š3æ¬¡
    data.validity_days || 7,      // âœ… æœ‰æ•ˆå¤©æ•°ï¼š7å¤©
    data.expires_at || null,      // æ¿€æ´»ç æœ¬èº«çš„æˆªæ­¢æ—¥æœŸï¼ˆä¸€èˆ¬ä¸è®¾ç½®ï¼‰
    data.notes || '',
    data.created_by || 'admin'
  ]
)
```

**âœ… åˆ›å»ºæ—¶æ­£ç¡®è®¾ç½®äº† validity_days=7 å’Œ daily_limit=3**

---

#### 2.2 éªŒè¯æ¿€æ´»ç  `verifyActivationCode()`

##### ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ¿€æ´»ç çŠ¶æ€ï¼ˆç¬¬46-60è¡Œï¼‰
```javascript
if (code.status !== 'active') {
  return { valid: false, error: 'æ¿€æ´»ç å·²å¤±æ•ˆ' };
}

// âš ï¸ æ£€æŸ¥æ¿€æ´»ç æœ¬èº«æ˜¯å¦è¿‡æœŸï¼ˆè¿™æ˜¯æ¿€æ´»ç çš„å¯æ¿€æ´»æˆªæ­¢æ—¥æœŸï¼‰
if (code.expires_at && new Date(code.expires_at) < new Date()) {
  await pool.query('UPDATE activation_codes SET status = ? WHERE id = ?', ['expired', code.id]);
  return { valid: false, error: 'æ¿€æ´»ç å·²è¿‡æœŸ' };
}

// æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æœ€å¤§æ¿€æ´»è®¾å¤‡æ•°
if (code.current_uses >= code.max_uses) {
  await pool.query('UPDATE activation_codes SET status = ? WHERE id = ?', ['used', code.id]);
  return { valid: false, error: 'æ¿€æ´»ç ä½¿ç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™' };
}
```

##### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥è®¾å¤‡æ¿€æ´»è®°å½•ï¼ˆç¬¬68-98è¡Œï¼‰
```javascript
// æŸ¥è¯¢è¯¥è®¾å¤‡æ˜¯å¦å·²æ¿€æ´»è¿‡
let [records] = await pool.query(
  'SELECT * FROM activation_records WHERE activation_code = ? AND user_device_id = ?',
  [inputCode, deviceId]
);

if (records.length > 0) {
  // å·²æ¿€æ´»ï¼Œæ£€æŸ¥æ˜¯å¦è¿‡æœŸ
  const record = records[0];
  
  // âœ… æ£€æŸ¥ç”¨æˆ·çš„æ¿€æ´»æ˜¯å¦è¿‡æœŸï¼ˆexpires_at æ˜¯ activated_at + validity_daysï¼‰
  if (record.expires_at && new Date(record.expires_at) < new Date()) {
    return { valid: false, error: 'æ‚¨çš„æ¿€æ´»å·²è¿‡æœŸ' };
  }
  
  // âœ… æ£€æŸ¥ä»Šæ—¥ä½¿ç”¨æ¬¡æ•°
  const today = new Date().toISOString().split('T')[0];
  const usageByDate = JSON.parse(record.usage_by_date || '{}');
  const todayUsage = usageByDate[today] || 0;
  
  if (todayUsage >= code.daily_limit) {
    return {
      valid: false,
      error: `ä»Šæ—¥ä½¿ç”¨æ¬¡æ•°å·²è¾¾ä¸Šé™ï¼ˆ${code.daily_limit}æ¬¡ï¼‰`,
      isActivated: true,
      expiresAt: record.expires_at
    };
  }
  
  return { valid: true, ... };
}
```

##### ç¬¬ä¸‰æ­¥ï¼šé¦–æ¬¡æ¿€æ´»ï¼ˆç¬¬100-125è¡Œï¼‰
```javascript
// æœªæ¿€æ´»ï¼Œåˆ›å»ºæ–°è®°å½•
// âœ…âœ…âœ… å…³é”®ï¼šè¿™é‡Œè®¡ç®—ç”¨æˆ·çš„æ¿€æ´»è¿‡æœŸæ—¶é—´
const expiresAt = new Date();
expiresAt.setDate(expiresAt.getDate() + code.validity_days); // âœ… å½“å‰æ—¶é—´ + 7å¤©

const [result] = await pool.query(
  `INSERT INTO activation_records 
   (code_id, activation_code, user_device_id, expires_at, usage_by_date) 
   VALUES (?, ?, ?, ?, ?)`,
  [code.id, inputCode, deviceId, expiresAt, JSON.stringify({})]
);

// æ›´æ–°æ¿€æ´»ç çš„å·²æ¿€æ´»è®¾å¤‡æ•°
await pool.query(
  'UPDATE activation_codes SET current_uses = current_uses + 1 WHERE id = ?',
  [code.id]
);
```

**âœ… éªŒè¯é€»è¾‘å®Œæ•´ï¼š**
- âœ… é¦–æ¬¡æ¿€æ´»æ—¶å¼€å§‹å€’è®¡æ—¶ï¼ˆexpires_at = now + validity_daysï¼‰
- âœ… æ£€æŸ¥æ¿€æ´»æ˜¯å¦è¿‡æœŸ
- âœ… æ£€æŸ¥ä»Šæ—¥ä½¿ç”¨æ¬¡æ•°æ˜¯å¦è¾¾åˆ°ä¸Šé™

---

#### 2.3 è®°å½•ä½¿ç”¨ `recordUsage()`

```javascript:backend/activationService.js
// ç¬¬136-190è¡Œ
async function recordUsage(recordId) {
  const today = new Date().toISOString().split('T')[0];
  
  // è·å–æ¿€æ´»è®°å½•å’Œæ¿€æ´»ç ä¿¡æ¯
  const [records] = await pool.query(
    `SELECT ar.*, ac.daily_limit 
     FROM activation_records ar 
     JOIN activation_codes ac ON ar.code_id = ac.id 
     WHERE ar.id = ?`,
    [recordId]
  );
  
  const record = records[0];
  
  // âœ… æ›´æ–°æ¯æ—¥ä½¿ç”¨è®°å½•
  const usageByDate = JSON.parse(record.usage_by_date || '{}');
  usageByDate[today] = (usageByDate[today] || 0) + 1;
  
  // âœ… æ›´æ–°æ•°æ®åº“
  await pool.query(
    `UPDATE activation_records 
     SET usage_count = usage_count + 1,    -- æ€»æ¬¡æ•° +1
         last_used_at = NOW(), 
         usage_by_date = ?                 -- æ›´æ–°æ¯æ—¥ç»Ÿè®¡
     WHERE id = ?`,
    [JSON.stringify(usageByDate), recordId]
  );
  
  // âœ… è®¡ç®—å‰©ä½™å¤©æ•°
  const now = new Date();
  const expiresAt = record.expires_at ? new Date(record.expires_at) : null;
  const msLeft = expiresAt ? (expiresAt - now) : 0;
  const daysLeft = Math.max(0, Math.ceil(msLeft / (24 * 60 * 60 * 1000)));
  const expired = msLeft <= 0;
  
  // âœ… è®¡ç®—ä»Šæ—¥å‰©ä½™æ¬¡æ•°
  const dailyLimit = record.daily_limit || 3;
  const todayUsed = usageByDate[today];
  const remainingToday = Math.max(0, dailyLimit - todayUsed);
  
  return { 
    success: true,
    daysLeft,
    remainingToday,
    expired,
    expiresAt: record.expires_at
  };
}
```

**âœ… æ‰£æ¬¡æ•°é€»è¾‘å®Œæ•´ï¼š**
- âœ… æ¯æ¬¡è°ƒç”¨æ‰£é™¤1æ¬¡ï¼ˆusage_count + 1ï¼‰
- âœ… æŒ‰æ—¥æœŸç»Ÿè®¡ï¼ˆusageByDateï¼‰
- âœ… è®¡ç®—å‰©ä½™å¤©æ•°
- âœ… è®¡ç®—ä»Šæ—¥å‰©ä½™æ¬¡æ•°

---

#### 2.4 è·å–æ¿€æ´»çŠ¶æ€ `getActivationStatusByCode()`

```javascript:backend/activationService.js
// ç¬¬195-243è¡Œ
async function getActivationStatusByCode(codeWithHyphen, deviceId) {
  // è¯»å–æ¿€æ´»ç ä¸è®¾å¤‡è®°å½•
  const [codes] = await pool.query('SELECT * FROM activation_codes WHERE code = ?', [norm]);
  const ac = codes[0];

  const [records] = await pool.query(
    'SELECT * FROM activation_records WHERE activation_code = ? AND user_device_id = ? LIMIT 1',
    [norm, deviceId]
  );
  const rec = records[0];
  
  // âœ… è®¡ç®—å‰©ä½™å¤©æ•°
  const now = new Date();
  const expiresAt = rec.expires_at ? new Date(rec.expires_at) : null;
  const msLeft = expiresAt ? (expiresAt - now) : 0;
  const daysLeft = Math.max(0, Math.ceil(msLeft / (24 * 60 * 60 * 1000)));
  const expired = msLeft <= 0;

  // âœ… è®¡ç®—ä»Šæ—¥å‰©ä½™æ¬¡æ•°
  const today = new Date().toISOString().split('T')[0];
  const usageByDate = JSON.parse(rec.usage_by_date || '{}');
  const usedToday = usageByDate[today] || 0;
  const dailyLimit = ac.daily_limit || 3;
  const remainingToday = Math.max(0, dailyLimit - usedToday);

  return {
    success: true,
    daysLeft,
    remainingToday,
    expired,
    dailyLimit,
    expiresAt,
    totalUsage: rec.usage_count || 0
  };
}
```

**âœ… çŠ¶æ€æŸ¥è¯¢é€»è¾‘å®Œæ•´ï¼šå®æ—¶è®¡ç®—å‰©ä½™å¤©æ•°å’Œæ¬¡æ•°**

---

### 3. å‰ç«¯é€»è¾‘åˆ†æ

#### 3.1 æ¿€æ´»ç éªŒè¯ï¼ˆ`src/utils/activation.js`ï¼‰

```javascript:src/utils/activation.js
// ç¬¬47-89è¡Œ
export async function verifyActivationCode(code) {
  if (USE_LOCAL_BACKEND) {
    const deviceId = getDeviceId();
    const result = await verifyWithBackend(code, deviceId);
    
    if (result.valid) {
      // âœ… ä¿å­˜æ¿€æ´»ä¿¡æ¯åˆ°æœ¬åœ°
      saveActivationFromBackend(code, result);
      
      // âœ… è®¡ç®—å‰©ä½™å¤©æ•°
      const expiresAt = result.expiresAt ? new Date(result.expiresAt) : null;
      let daysLeft = 7;
      if (expiresAt) {
        const msLeft = expiresAt.getTime() - Date.now();
        daysLeft = Math.max(0, Math.ceil(msLeft / (24 * 60 * 60 * 1000)));
      }
      
      // âœ… è®¡ç®—ä»Šæ—¥å‰©ä½™æ¬¡æ•°
      const todayUsage = result.todayUsage || 0;
      const dailyLimit = result.dailyLimit || 3;
      const remainingToday = Math.max(0, dailyLimit - todayUsage);
      
      return {
        valid: true,
        data: {
          daysLeft: daysLeft,
          remainingToday: remainingToday,
          recordId: result.recordId,
          expiresAt: result.expiresAt
        }
      };
    }
  }
}
```

**âœ… å‰ç«¯æ­£ç¡®è°ƒç”¨åç«¯APIå¹¶ä¿å­˜çŠ¶æ€**

---

#### 3.2 è·å–æ¿€æ´»çŠ¶æ€ï¼ˆ`src/utils/activation.js`ï¼‰

```javascript:src/utils/activation.js
// ç¬¬436-476è¡Œ
export async function getActivationStatus() {
  const code = getActivationCode();
  
  // âœ… æœ¬åœ°åç«¯ï¼šç›´æ¥å‘åç«¯æŸ¥è¯¢æœ€æ–°çŠ¶æ€ï¼Œç¡®ä¿ä¸æ•°æ®åº“å¯¹é½
  if (USE_LOCAL_BACKEND && code) {
    const deviceId = getDeviceId();
    const result = await fetchActivationStatus(code, deviceId);
    
    if (result && result.success) {
      // âœ… æ›´æ–°æœ¬åœ°ç¼“å­˜
      let usage = readUsage();
      if (usage) {
        usage.daysLeft = result.daysLeft;
        usage.remainingToday = result.remainingToday;
        usage.expired = result.expired;
        usage.dailyLimit = result.dailyLimit || usage.dailyLimit || 3;
        if (result.expiresAt) usage.expiresAt = new Date(result.expiresAt).toISOString();
        usage.syncedDate = todayStr();
        localStorage.setItem('activation_usage', JSON.stringify(usage));
      }
      
      return {
        daysLeft: result.daysLeft,
        remainingToday: result.remainingToday,
        expired: result.expired,
        dailyLimit: result.dailyLimit || 3
      };
    }
  }
}
```

**âœ… å‰ç«¯æ¯æ¬¡éƒ½ä»åç«¯è·å–æœ€æ–°çŠ¶æ€**

---

#### 3.3 è®°å½•ä½¿ç”¨ï¼ˆ`src/utils/activation.js`ï¼‰

```javascript:src/utils/activation.js
// ç¬¬536-636è¡Œ
export async function recordOneUsage() {
  const code = getActivationCode();
  const usage = readUsage();
  
  // âœ… ä¼˜å…ˆä½¿ç”¨æœ¬åœ°åç«¯è®°å½•ä½¿ç”¨æ¬¡æ•°
  if (USE_LOCAL_BACKEND && usage.recordId) {
    console.log('ğŸ“Š [æ‰£æ¬¡æ•°] è°ƒç”¨æœ¬åœ°åç«¯è®°å½•ä½¿ç”¨æ¬¡æ•°...');
    const result = await recordUsage(usage.recordId);
    
    if (result.success) {
      console.log(`âœ… [æ‰£æ¬¡æ•°] æˆåŠŸï¼å‰©ä½™ ${result.remainingToday} æ¬¡/ä»Šæ—¥ï¼Œ${result.daysLeft} å¤©`);
      
      // âœ… æ›´æ–°æœ¬åœ°ç¼“å­˜
      usage.remainingToday = result.remainingToday;
      usage.daysLeft = result.daysLeft;
      if (result.expiresAt) {
        usage.expiresAt = new Date(result.expiresAt).toISOString();
      }
      localStorage.setItem('activation_usage', JSON.stringify(usage));
      
      return {
        daysLeft: result.daysLeft,
        remainingToday: result.remainingToday,
        expired: result.expired || false,
        recorded: true
      };
    }
  }
}
```

**âœ… æµ‹è¯„å®Œæˆåæ­£ç¡®è°ƒç”¨åç«¯æ‰£é™¤æ¬¡æ•°**

---

#### 3.4 æµ‹è¯„é¡µé¢è°ƒç”¨ï¼ˆ`src/views/AssessmentPage.vue`ï¼‰

```javascript:src/views/AssessmentPage.vue
// ç¬¬885è¡Œ
const rec = await recordOneUsage();
if (rec && rec.recorded) {
  showToast(`æµ‹è¯•å®Œæˆï¼ä»Šæ—¥å‰©ä½™${rec.remainingToday}æ¬¡ Â· å‰©ä½™${rec.daysLeft}å¤©`, 2200, 'success');
  // è§¦å‘å¯¼èˆªæ åˆ·æ–°
  window.dispatchEvent(new Event('activation-updated'));
}
```

**âœ… æµ‹è¯„æäº¤æ—¶æ­£ç¡®æ‰£é™¤æ¬¡æ•°å¹¶æ˜¾ç¤ºå‰©ä½™çŠ¶æ€**

---

### 4. APIè·¯ç”±æ£€æŸ¥ï¼ˆ`backend/routes/activationRoutes.js`ï¼‰

```javascript:backend/routes/activationRoutes.js
// POST /api/activation/verify - éªŒè¯æ¿€æ´»ç 
router.post('/verify', async (req, res) => {
  const { code, deviceId } = req.body;
  const result = await verifyActivationCode(code, deviceId);
  res.json(result);
});

// POST /api/activation/record-usage - è®°å½•ä½¿ç”¨æ¬¡æ•°
router.post('/record-usage', async (req, res) => {
  const { recordId } = req.body;
  const result = await recordUsage(recordId);
  res.json(result);
});

// POST /api/activation/status - è·å–æ¿€æ´»çŠ¶æ€
router.post('/status', async (req, res) => {
  const { code, deviceId } = req.body;
  const result = await getActivationStatusByCode(code, deviceId);
  res.json(result);
});
```

**âœ… APIè·¯ç”±å®Œæ•´ï¼Œæ”¯æŒæ‰€æœ‰æ“ä½œ**

---

## âœ… é€»è¾‘éªŒè¯æ€»ç»“

### å®Œå…¨ç¬¦åˆéœ€æ±‚çš„åŠŸèƒ½ï¼š

1. âœ… **åˆ›å»º7å¤©æ¿€æ´»ç ï¼Œæ¯å¤©3æ¬¡**
   - ç®¡ç†åå°é»˜è®¤å€¼ï¼š`validity_days: 7, daily_limit: 3`
   - æ•°æ®åº“å­—æ®µæ­£ç¡®ä¿å­˜

2. âœ… **ç”¨æˆ·æ¿€æ´»æ—¶å¼€å§‹å€’è®¡æ—¶**
   - `verifyActivationCode()` ç¬¬101-102è¡Œï¼š`expiresAt = now + validity_days`
   - ä»ç”¨æˆ·é¦–æ¬¡æ¿€æ´»æ—¶åˆ»å¼€å§‹è®¡æ—¶

3. âœ… **åå°è®¡ç®—æ—¶é—´**
   - `recordUsage()` è®¡ç®—å‰©ä½™å¤©æ•°ï¼š`daysLeft = Math.ceil((expiresAt - now) / 86400000)`
   - `getActivationStatusByCode()` å®æ—¶è®¡ç®—çŠ¶æ€

4. âœ… **æ¯æ¬¡æµ‹è¯•æ‰£ä¸€æ¬¡**
   - `recordUsage()` æ›´æ–° `usage_count` å’Œ `usageByDate`
   - AssessmentPage æäº¤æ—¶è°ƒç”¨ `recordOneUsage()`

5. âœ… **æ¯å¤©æœ€å¤š3æ¬¡**
   - `verifyActivationCode()` ç¬¬80è¡Œæ£€æŸ¥ `todayUsage >= code.daily_limit`
   - `recordUsage()` è®¡ç®— `remainingToday`

6. âœ… **æ—¶é—´ç»“æŸåå¤±æ•ˆ**
   - `verifyActivationCode()` ç¬¬71-73è¡Œæ£€æŸ¥ `record.expires_at < now`
   - `recordUsage()` è¿”å› `expired` çŠ¶æ€

---

## âš ï¸ æ½œåœ¨é—®é¢˜æ’æŸ¥

è™½ç„¶é€»è¾‘å®Œæ•´ï¼Œä½†å¯èƒ½å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

### é—®é¢˜1ï¼šæ—¶åŒºé—®é¢˜
- åç«¯ä½¿ç”¨ `new Date()` å’Œ MySQL `DATETIME`ï¼Œå¯èƒ½å­˜åœ¨æ—¶åŒºå·®å¼‚
- å»ºè®®ç»Ÿä¸€ä½¿ç”¨ UTC æ—¶é—´

### é—®é¢˜2ï¼šæ¯æ—¥é‡ç½®æ—¶é—´ç‚¹
- å½“å‰æŒ‰ `YYYY-MM-DD` å­—ç¬¦ä¸²åˆ¤æ–­ï¼Œä»¥æœ¬åœ°0ç‚¹ä¸ºåˆ†ç•Œ
- å¦‚æœæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¶åŒºä¸åŒï¼Œå¯èƒ½å¯¼è‡´è¯¯å·®

### é—®é¢˜3ï¼šexpires_at å­—æ®µæ··æ·†
- `activation_codes.expires_at`ï¼šæ¿€æ´»ç æœ¬èº«çš„è¿‡æœŸæ—¶é—´ï¼ˆå¯æ¿€æ´»æˆªæ­¢æ—¥æœŸï¼‰
- `activation_records.expires_at`ï¼šç”¨æˆ·æ¿€æ´»åçš„ä½¿ç”¨æœŸé™
- å»ºè®®åœ¨ç®¡ç†åå°æ˜ç¡®è¯´æ˜ï¼Œé¿å…æ··æ·†

---

## ğŸ”§ å»ºè®®ä¼˜åŒ–

### 1. æ·»åŠ æ—¶åŒºè¯´æ˜
åœ¨ç®¡ç†åå°å’Œæ•°æ®åº“æ³¨é‡Šä¸­æ˜ç¡®æ—¶é—´éƒ½æ˜¯æœåŠ¡å™¨æœ¬åœ°æ—¶é—´ã€‚

### 2. å®Œå–„ç®¡ç†åå°æç¤º
```vue
<p class="field-hint">
  æœ‰æ•ˆå¤©æ•°ï¼šç”¨æˆ·æ¿€æ´»åå¯ä½¿ç”¨çš„å¤©æ•°ï¼ˆä»é¦–æ¬¡æ¿€æ´»æ—¶åˆ»å¼€å§‹å€’è®¡æ—¶ï¼‰
</p>
<p class="field-hint">
  è¿‡æœŸæ—¶é—´ï¼šæ¿€æ´»ç çš„å¯æ¿€æ´»æˆªæ­¢æ—¥æœŸï¼ˆç•™ç©ºåˆ™æ°¸ä¹…å¯æ¿€æ´»ï¼Œç›´åˆ°ç”¨å®Œæ¬¡æ•°ï¼‰
</p>
```

### 3. æ·»åŠ è‡ªåŠ¨è¿‡æœŸä»»åŠ¡
åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œæ¯å°æ—¶æ£€æŸ¥è¿‡æœŸçš„æ¿€æ´»è®°å½•ï¼Œè‡ªåŠ¨æ›´æ–°çŠ¶æ€ã€‚

---

## ğŸ“Š æµ‹è¯•éªŒè¯æ­¥éª¤

1. **åˆ›å»ºæµ‹è¯•æ¿€æ´»ç **
   ```sql
   INSERT INTO activation_codes (code, validity_days, daily_limit, max_uses) 
   VALUES ('TEST-ABCD-1234', 7, 3, 1);
   ```

2. **é¦–æ¬¡æ¿€æ´»**
   - ç”¨æˆ·è¾“å…¥æ¿€æ´»ç 
   - æ£€æŸ¥ `activation_records` è¡¨ï¼Œç¡®è®¤ `expires_at` = `activated_at + 7å¤©`

3. **æµ‹è¯•æ‰£æ¬¡æ•°**
   - å®Œæˆ1æ¬¡æµ‹è¯„ï¼Œæ£€æŸ¥ `usage_count = 1`ï¼Œ`usageByDate = {"2025-11-05": 1}`
   - å®Œæˆ3æ¬¡æµ‹è¯„ï¼Œæ£€æŸ¥ä»Šæ—¥æ— æ³•å†æµ‹è¯•

4. **æµ‹è¯•æ—¶é—´è¿‡æœŸ**
   - ä¿®æ”¹ `expires_at` ä¸ºè¿‡å»æ—¶é—´
   - å°è¯•æµ‹è¯„ï¼Œåº”æç¤º"æ¿€æ´»å·²è¿‡æœŸ"

---

## ğŸ¯ ç»“è®º

**æ•´ä½“é€»è¾‘è®¾è®¡å®Œå…¨ç¬¦åˆéœ€æ±‚ï¼Œå®ç°æ­£ç¡®ï¼**

âœ… æ—¶é—´è®¡ç®—ä»ç”¨æˆ·æ¿€æ´»å¼€å§‹
âœ… æ¯æ—¥3æ¬¡é™åˆ¶æ­£ç¡®å®ç°
âœ… 7å¤©å€’è®¡æ—¶æ­£ç¡®è®¡ç®—
âœ… æ‰£æ¬¡æ•°é€»è¾‘å®Œæ•´

å¦‚æœç”¨æˆ·åé¦ˆ"æ²¡æœ‰æ—¶é—´è®¡ç®—"ï¼Œå¯èƒ½æ˜¯ï¼š
1. æ•°æ®åº“ä¸­å†å²æ¿€æ´»è®°å½•çš„ `expires_at` ä¸ºç©º
2. åˆ›å»ºæ¿€æ´»ç æ—¶è®¾ç½®äº†é”™è¯¯çš„ `activation_codes.expires_at`
3. å‰ç«¯ç¼“å­˜é—®é¢˜ï¼Œéœ€è¦åˆ·æ–°çŠ¶æ€

**å»ºè®®ï¼šæ¸…ç©ºæµ‹è¯•æ•°æ®ï¼Œé‡æ–°åˆ›å»ºæ¿€æ´»ç å¹¶æµ‹è¯•å®Œæ•´æµç¨‹ã€‚**

